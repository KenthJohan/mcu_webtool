<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MCU Flash Page Viewer (2kB)</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <h1>MCU Vibing</h1>

    <div class="container">

        <div class="left-panel">
            <div id="info">
                Page Base Address: <span class="address-display">0x0800F800</span> |
                Size: 2048 bytes (2kB) |
                Click on grid to view address
            </div>
            <div style="background-color: #f5f5f5; padding: 10px; margin: 10px 0; border-radius: 4px; display: flex; gap: 20px; align-items: center;">
                <div style="display: flex; align-items: center; gap: 5px;">
                    <label for="gridCols" style="font-weight: bold;">Columns:</label>
                    <input type="number" id="gridCols" min="1" max="2048" style="width: 80px; padding: 5px;" 
                           title="Use arrow keys to double/halve (powers of 2)" />
                </div>
                <div style="display: flex; align-items: center; gap: 5px;">
                    <label for="gridRows" style="font-weight: bold;">Rows:</label>
                    <input type="number" id="gridRows" min="1" max="2048" style="width: 80px; padding: 5px;" 
                           title="Use arrow keys to double/halve (powers of 2)" />
                </div>
                <div style="font-size: 0.9em; color: #666;">
                    (Total: <span id="gridTotal">2048</span> cells | Powers of 2: 1, 2, 4, 8, 16, 32, 64, 128, 256, 512, 1024, 2048)
                </div>
            </div>
            <div style="background-color: #e8f4f8; padding: 10px; margin: 10px 0; border-radius: 4px; display: flex; gap: 15px; align-items: center;">
                <div style="display: flex; align-items: center; gap: 5px;">
                    <label for="alignmentGrid" style="font-weight: bold;">Alignment Grid:</label>
                    <select id="alignmentGrid" style="padding: 5px;">
                        <option value="0">Off</option>
                        <option value="1">1 byte</option>
                        <option value="2">2 bytes</option>
                        <option value="4" selected>4 bytes</option>
                        <option value="8">8 bytes</option>
                        <option value="16">16 bytes</option>
                        <option value="32">32 bytes</option>
                    </select>
                </div>
                <div style="font-size: 0.9em; color: #666;">
                    Shows alignment boundaries for data structure packing
                </div>
            </div>
            <canvas id="gridCanvas"></canvas>
            <div id="cellInfo">Click on grid to see address information</div>
        </div>

        <div class="right-panel">
            <h3>Parameters in this Page</h3>
            <div id="parameterList">Loading...</div>

            <div id="unsavedChangesInfo" style="display: none; background-color: #fff3cd; border: 1px solid #ff9800; padding: 10px; margin: 10px 0; border-radius: 4px; color: #856404;">
                <strong>‚ö† Unsaved changes</strong>
            </div>

            <div style="margin: 10px 0;">
                <button id="saveChangesBtn" type="button" class="primary" style="display: none; background-color: #4CAF50;">
                    üíæ Save All Changes
                </button>
                <button id="discardChangesBtn" type="button" class="danger" style="display: none;">
                    üóëÔ∏è Discard Changes
                </button>
            </div>


        <h2>Add Parameter</h2>
        <form id="parameterForm">
            <div class="form-group">
                <label>Parameter Name:</label>
                <input type="text" id="paramName" name="name" required placeholder="e.g., CONFIG_TIMEOUT">
            </div>

            <div class="form-group">
                <label>Type:</label>
                <select id="paramType" name="type_id" required>
                    <option value="">Select Type</option>
                </select>
            </div>

            <div class="form-group">
                <label>Quantity:</label>
                <select id="paramQuantity" name="quantity_id">
                    <option value="">Select Quantity</option>
                </select>
            </div>

            <div class="form-group">
                <label>Unit:</label>
                <select id="paramUnit" name="unit_id">
                    <option value="">Select Unit</option>
                </select>
            </div>

            <div class="form-group">
                <label>Array Count:</label>
                <input type="number" id="paramCount" name="count" value="1" min="1" required>
            </div>

            <div class="form-group">
                <label>Size (bytes):</label>
                <input type="number" id="paramSize" name="size" value="4" min="1" max="2048" required readonly>
            </div>

            <div class="form-group">
                <label>Offset in Page:</label>
                <input type="number" id="paramOffset" name="offset" value="0" min="0" max="2047" required readonly>
            </div>

            <div class="form-group">
                <label>Description:</label>
                <textarea id="paramDescription" name="description" placeholder="Parameter description"></textarea>
            </div>

            <button type="button" class="secondary" onclick="gridCanvas.startSelection()">Select on Grid</button>
            <button type="submit">Add Parameter</button>
            <button type="button" class="danger" onclick="gridCanvas.clearSelection()">Clear</button>
        </form>
        </div>
    </div>



    <div id="selectionMode" class="selection-mode" style="display: none;">
        <strong>Selection Mode Active</strong><br>
        Click and drag on the grid to select parameter location
    </div>


    <script src="FlashPageGridCanvas.js"></script>
    <script>
        // Initialize the grid canvas
        const gridCanvas = new FlashPageGridCanvas('gridCanvas', {
            pageBaseAddress: 0x08003000,
            apiPath: 'api/select.php'
        });
        
        // Initialize when DOM is ready
        gridCanvas.init();
    </script>
</body>

</html>